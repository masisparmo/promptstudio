<!DOCTYPE html>
<html lang="id" class="dark"> <!-- Default ke mode gelap -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Engineering Studio: Panduan Mudah Cara Membuat Prompt Gambar dan Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-tertiary: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #d1d5db;
            --accent-color: #4f46e5;
            --accent-hover: #6366f1;
            --accent-text: #ffffff;
            --code-bg: #e5e7eb;
            --code-text: #be123c;
            --card-border: #e5e7eb;
            --prompt-card-bg: #f9fafb;
            --prompt-card-border: #4f46e5;
            --negative-bg: #fef2f2;
            --negative-border: #fca5a5;
            --negative-header-text: #b91c1c;
            --negative-body-text: #dc2626;
            --positive-bg: #f0fdf4;
            --positive-border: #86efac;
            --positive-header-text: #15803d;
            --positive-body-text: #16a34a;
        }

        html.dark {
            --bg-primary: #030712;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --accent-color: #6366f1;
            --accent-hover: #818cf8;
            --accent-text: #ffffff;
            --code-bg: #1f2937;
            --code-text: #a7f3d0;
            --card-border: #374151;
            --prompt-card-bg: #1f2937;
            --prompt-card-border: #6366f1;
            --negative-bg: #450a0a;
            --negative-border: #7f1d1d;
            --negative-header-text: #fca5a5;
            --negative-body-text: #f87171;
            --positive-bg: #166534;
            --positive-border: #22c55e;
            --positive-header-text: #bbf7d0;
            --positive-body-text: #86efac;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.15s ease-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--accent-text);
            border-bottom: 4px solid color-mix(in srgb, var(--accent-color) 80%, black);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: translateY(0);
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-primary:active {
            transform: translateY(1px);
            border-bottom-width: 2px;
            box-shadow: none;
        }
        
        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-bottom: 4px solid color-mix(in srgb, var(--bg-tertiary) 80%, black);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
            transform: translateY(-2px);
        }

        .btn-secondary:active {
            transform: translateY(1px);
            border-bottom-width: 2px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            border-bottom: 4px solid color-mix(in srgb, var(--bg-tertiary) 80%, black);
        }
        
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--card-border);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .form-input, .form-select {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-color) 20%, transparent);
        }

        .prompt-card {
             background-color: var(--prompt-card-bg);
             border-left: 4px solid var(--prompt-card-border);
        }

        .font-mono {
            background-color: var(--code-bg);
            color: var(--code-text);
        }

        .tab-button {
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
        }
        .tab-button.active {
            background-color: var(--accent-color);
            color: var(--accent-text);
        }
        .tab-button:not(.active):hover {
            background-color: var(--bg-tertiary);
        }
        .designer-tab-button {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .designer-tab-button:hover {
            color: var(--text-primary);
        }
        .designer-tab-button.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }

        .content-section, .designer-form, #main-app, #api-key-section {
            display: none;
        }
        .content-section.active, .designer-form.active, #main-app.active, #api-key-section.active {
            display: block;
        }

        .loader {
            width: 16px; height: 16px; border: 2px solid currentColor;
            border-bottom-color: transparent; border-radius: 50%;
            display: inline-block; box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

        #assistant-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
            background-color: var(--bg-secondary);
        }
        
        #assistant-button {
            background-color: var(--accent-color);
            border-bottom: 5px solid color-mix(in srgb, var(--accent-color) 70%, black);
            transition: all 0.15s ease-out;
        }
        #assistant-button:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }
        #assistant-button:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .aspect-ratio-option {
            color: var(--text-primary);
            cursor: pointer;
            position: relative;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .aspect-ratio-option:hover {
            background-color: var(--bg-tertiary);
        }
        .aspect-ratio-option svg {
            width: 1.25rem;
            height: 1.25rem;
            fill: var(--text-secondary);
        }
        #aspect-ratio-button svg {
            width: 1.25rem;
            height: 1.25rem;
            fill: var(--text-secondary);
        }
        #aspect-ratio-button .text-secondary {
             color: var(--text-secondary);
        }
       
        .bg-primary-solid {
            background-color: var(--bg-primary);
        }

        .negative-prompt-box, .positive-prompt-box {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border-width: 1px;
        }
        .negative-prompt-box {
            background-color: var(--negative-bg);
            border-color: var(--negative-border);
        }
        .negative-prompt-box h4 {
            color: var(--negative-header-text);
        }
        .negative-prompt-box p {
            color: var(--negative-body-text);
        }
        .positive-prompt-box {
            background-color: var(--positive-bg);
            border-color: var(--positive-border);
        }
        .positive-prompt-box h4 {
            color: var(--positive-header-text);
        }
        .positive-prompt-box p {
            color: var(--positive-body-text);
        }

        .typing-indicator span {
            animation: blink 1.4s infinite both;
            display: inline-block;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }

        #assistant-chat-body {
            overflow-y: auto; 
        }

        .chat-bubble {
            white-space: pre-wrap;
            word-break: break-word;
        }
    </style>
</head>
<body class="antialiased">
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="min-h-screen flex flex-col items-center justify-center p-4">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                PROMPT STUDIO
            </h1>
            <p class="mt-2 text-lg text-slate-500 dark:text-slate-400">Pilih Lingkungan Untuk Menjalankan Aplikasi</p>
        </div>
        
        <div class="w-full max-w-2xl grid md:grid-cols-2 gap-6">
            <!-- Option 1: Shared Environment -->
            <div class="card p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500 mb-4"><path d="M10 20.5c0 .83.67 1.5 1.5 1.5h1c.83 0 1.5-.67 1.5-1.5v-6c0-.83-.67-1.5-1.5-1.5h-1c-.83 0-1.5.67-1.5 1.5v6Z"/><path d="M18.5 22c.83 0 1.5-.67 1.5-1.5v-11c0-.83-.67-1.5-1.5-1.5h-1c-.83 0-1.5.67-1.5 1.5v11c0 .83.67 1.5 1.5 1.5h1Z"/><path d="M5.5 22c.83 0 1.5-.67 1.5-1.5V15c0-.83-.67-1.5-1.5-1.5h-1C3.67 13.5 3 14.17 3 15v5.5c0 .83.67 1.5 1.5 1.5h1Z"/><path d="m2 14 3-3 3 3"/><path d="M13 3 7.5 8.5"/><path d="m14 4 6 6"/><path d="M10.5 8.5 16 3"/></svg>
                <h2 class="text-xl font-bold mb-2">Lingkungan Gemini</h2>
                <p class="text-secondary mb-4 text-sm">Gunakan lingkungan Gemini milik Anda. Tidak perlu API Key.</p>
                <button id="use-shared-env" class="btn btn-primary w-full">LANJUTKAN</button>
            </div>
            
            <!-- Option 2: User API Key -->
            <div class="card p-6 flex flex-col items-center text-center">
                 <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-500 mb-4"><path d="m15 12-8.373 8.373a1 1 0 1 1-1.414-1.414L12.172 12 5.213 5.043a1 1 0 1 1 1.414-1.414L15 12Z"/><path d="m3 12 2.394 2.394a1 1 0 0 0 1.414 0L9.121 12l-2.313-2.313a1 1 0 0 0-1.414 0L3 12Z"/></svg>
                <h2 class="text-xl font-bold mb-2">Gunakan kode API Gemini</h2>
                <p class="text-secondary mb-4 text-sm">Masukkan kode API Key Gemini milik Anda sendiri.</p>
                <button id="use-user-api-key" class="btn btn-secondary w-full">MASUKKAN API KEY</button>
            </div>
        </div>

        <!-- API Key Input Section -->
        <div id="api-key-section" class="w-full max-w-lg mt-6">
            <div class="card p-6">
                <h3 class="text-lg font-semibold mb-4">Masukkan API Key Gemini Anda</h3>
                <input type="password" id="api-key-input" class="form-input w-full p-2.5 mb-4" placeholder="AIzaSy...">
                <button id="start-with-api-key" class="btn btn-primary w-full">MULAI STUDIO</button>
                <div class="text-xs text-secondary mt-4">
                    <p>
                        Belum punya API Key? Dapatkan secara gratis dari 
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="font-semibold text-indigo-400 hover:underline">Google AI Studio</a>. 
                        Cukup klik "Create API key in new project".
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="main-app" class="container mx-auto p-4 md:p-8">
        <header class="flex justify-between items-center mb-8">
            <div class="w-12 h-12"></div>
            <div class="flex-grow text-center">
                 <h1 class="text-4xl md:text-5xl font-bold tracking-tight">
                    PROMPT STUDIO
                </h1>
                <p class="mt-2 text-lg text-secondary">Cara Mudah Membuat Prompt Image & Video</p>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full bg-tertiary hover:bg-border-color transition-colors w-12 h-12 flex items-center justify-center">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </header>

        <div class="flex justify-center mb-8 bg-secondary rounded-lg p-1.5 shadow-md max-w-md mx-auto">
            <button id="tab-belajar" class="tab-button active w-1/2 py-2 px-4 rounded-md">
                PANDUAN PROMPT
            </button>
            <button id="tab-desainer" class="tab-button w-1/2 py-2 px-4 rounded-md">
                DESAINER PROMPT
            </button>
        </div>

        <main>
            <section id="content-belajar" class="content-section active space-y-8">
                <article class="card p-6 md:p-8">
                    <h2 class="text-3xl font-bold mb-4">Materi 1: Prompt Engineering untuk Gambar (Nano Banana)</h2>
                    <p class="mb-6 text-secondary">Menguasai Gemini Image Generation dimulai dari satu prinsip fundamental: <strong>Deskripsikan adegan, jangan hanya mendaftar kata kunci</strong>. Kekuatan inti model ini adalah pemahaman bahasanya yang mendalam. Paragraf naratif yang deskriptif hampir selalu menghasilkan gambar yang lebih baik dan koheren.</p>
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-2xl font-bold">Strategi Prompt untuk Menciptakan Gambar</h3>
                            <p class="mt-2 text-secondary">Berikut adalah strategi dan template yang terbukti efektif untuk berbagai kebutuhan kreatif dan bisnis.</p>
                            <div class="mt-4 space-y-6">
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">1. Adegan Fotorealistis</h4>
                                    <p class="text-sm mb-2 text-secondary">Gunakan istilah fotografi. Sebutkan sudut kamera, jenis lensa, pencahayaan, dan detail halus untuk memandu model menuju hasil yang nyata.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Sebuah foto [tipe shot] fotorealistis dari [subjek], [aksi atau ekspresi], berlatar di [lingkungan]. Adegan disinari oleh [deskripsi pencahayaan], menciptakan suasana [mood]. Ditangkap dengan [detail kamera/lensa], menekankan [tekstur dan detail utama]."</p>
                                </div>
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">2. Teks Akurat dalam Gambar (Logo & Poster)</h4>
                                    <p class="text-sm mb-2 text-secondary">Gemini unggul dalam merender teks. Jelaskan teksnya, gaya font (secara deskriptif), dan desain keseluruhannya.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Buat [jenis gambar] untuk [brand/konsep] dengan teks '[teks yang akan dirender]' dalam [gaya font]. Desainnya harus [deskripsi gaya], dengan [skema warna]."</p>
                                </div>
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">3. Mockup Produk & Fotografi Komersial</h4>
                                    <p class="text-sm mb-2 text-secondary">Sempurna untuk membuat foto produk yang bersih dan profesional untuk e-commerce, periklanan, atau branding.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Sebuah foto produk resolusi tinggi dengan pencahayaan studio dari [deskripsi produk] di atas [permukaan/deskripsi latar]. Pencahayaan [pengaturan pencahayaan] untuk [tujuan pencahayaan]. Sudut kamera [jenis sudut] untuk menampilkan [fitur spesifik]. Sangat realistis, dengan fokus tajam."</p>
                                </div>
                                 <div class="prompt-card p-4">
                                    <h4 class="font-semibold">4. Ilustrasi & Stiker Bergaya</h4>
                                    <p class="text-sm mb-2 text-secondary">Untuk membuat stiker atau ikon, jelaskan gayanya secara eksplisit dan minta latar belakang transparan.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Sebuah stiker gaya [gaya] dari [subjek], menampilkan [karakteristik utama] dan [palet warna]. Desainnya memiliki [gaya garis] dan [gaya bayangan]. Latar belakang harus transparan."</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold mt-8">Strategi Prompt untuk Mengedit Gambar</h3>
                            <p class="mt-2 text-secondary">Berikan gambar bersama dengan prompt teks Anda untuk pengeditan, komposisi, dan transfer gaya yang canggih.</p>
                             <div class="mt-4 space-y-6">
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">1. Menambah & Menghapus Elemen</h4>
                                    <p class="text-sm mb-2 text-secondary">Sediakan gambar dan jelaskan perubahan Anda. Model akan mencocokkan gaya, pencahayaan, dan perspektif gambar asli.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Gunakan gambar [subjek] yang disediakan, tolong [tambahkan/hapus/modifikasi] [elemen] ke/dari adegan. Pastikan perubahannya [deskripsi bagaimana perubahan harus berintegrasi]."</p>
                                </div>
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">2. Inpainting (Semantic Masking)</h4>
                                    <p class="text-sm mb-2 text-secondary">Definisikan "masker" secara percakapan untuk mengedit bagian tertentu dari gambar sambil membiarkan sisanya tidak tersentuh.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Gunakan gambar yang disediakan, ubah hanya [elemen spesifik] menjadi [elemen/deskripsi baru]. Biarkan semua yang lain dalam gambar tetap sama persis, pertahankan gaya, pencahayaan, dan komposisi asli."</p>
                                </div>
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">3. Transfer Gaya (Style Transfer)</h4>
                                    <p class="text-sm mb-2 text-secondary">Sediakan gambar dan minta model untuk menciptakan kembali kontennya dalam gaya artistik yang berbeda.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Ubah foto [subjek] yang disediakan menjadi gaya artistik [seniman/gaya seni]. Pertahankan komposisi asli tetapi render dengan [deskripsi elemen gaya]."</p>
                                </div>
                                 <div class="prompt-card p-4">
                                    <h4 class="font-semibold">4. Komposisi Lanjutan (Menggabungkan Beberapa Gambar)</h4>
                                    <p class="text-sm mb-2 text-secondary">Sediakan beberapa gambar sebagai konteks untuk membuat adegan komposit baru. Sempurna untuk mockup produk atau kolase kreatif.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">"Buat gambar baru dengan menggabungkan elemen dari gambar yang disediakan. Ambil [elemen dari gambar 1] dan letakkan dengan/di [elemen dari gambar 2]. Gambar akhir harus berupa [deskripsi adegan akhir]."</p>
                                </div>
                            </div>
                        </div>
                         <div>
                            <h3 class="text-2xl font-bold mt-8">Praktik Terbaik untuk Hasil Profesional</h3>
                            <ul class="list-disc list-inside mt-2 space-y-2 text-secondary">
                                <li><strong>Jadilah Sangat Spesifik:</strong> Semakin banyak detail yang Anda berikan, semakin besar kendali Anda. Alih-alih "baju zirah fantasi," jelaskan: "baju zirah pelat elf yang berornamen, diukir dengan pola daun perak, dengan kerah tinggi."</li>
                                <li><strong>Berikan Konteks & Niat:</strong> Jelaskan *tujuan* gambar tersebut. Misalnya, "Buat logo untuk merek perawatan kulit kelas atas yang minimalis."</li>
                                <li><strong>Iterasi & Perbaiki:</strong> Gunakan sifat percakapan model untuk melakukan perubahan kecil. Lanjutkan dengan prompt seperti, "Itu bagus, tapi bisakah Anda membuat pencahayaannya sedikit lebih hangat?"</li>
                                <li><strong>Gunakan Instruksi Bertahap:</strong> Untuk adegan yang kompleks, bagi prompt Anda menjadi beberapa langkah. "Pertama, buat latar belakang hutan berkabut yang tenang saat fajar. Kemudian, di latar depan, tambahkan altar batu kuno yang tertutup lumut..."</li>
                                <li><strong>Kendalikan Kamera:</strong> Gunakan bahasa fotografi dan sinematik untuk mengontrol komposisi, seperti *wide-angle shot, macro shot, low-angle perspective.*</li>
                            </ul>
                        </div>
                    </div>
                </article>
                <article class="card p-6 md:p-8">
                    <h2 class="text-3xl font-bold mb-4">Materi 2: Prompt Engineering untuk Video (Veo3)</h2>
                    <p class="mb-6 text-secondary">Prompt yang baik bersifat deskriptif dan jelas. Untuk mendapatkan hasil maksimal dari Veo, mulailah dengan mengidentifikasi ide inti Anda, sempurnakan dengan kata kunci, dan gabungkan terminologi khusus video.</p>
                     <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-indigo-400">1. Elemen Dasar Penulisan Prompt</h3>
                            <p class="mt-1 text-secondary">Prompt video yang komprehensif harus mencakup elemen-elemen berikut:</p>
                            <ul class="list-disc list-inside mt-2 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 text-secondary">
                                <li><b>Subjek:</b> Objek, orang, atau pemandangan utama (misal: "sebuah mobil sport merah").</li>
                                <li><b>Aksi:</b> Apa yang dilakukan subjek (misal: "melaju kencang di jalanan pesisir").</li>
                                <li><b>Gaya:</b> Arahan kreatif atau estetika (misal: "gaya film fiksi ilmiah tahun 80-an", "animasi kartun").</li>
                                <li><b>Posisi & Gerakan Kamera:</b> Kendalikan sudut pandang (misal: "aerial view", "eye-level", "dolly shot").</li>
                                <li><b>Komposisi:</b> Bagaimana shot dibingkai (misal: "wide shot", "close-up", "single-shot").</li>
                                <li><b>Fokus & Lensa:</b> Efek visual spesifik (misal: "shallow focus", "macro lens", "wide-angle lens").</li>
                                <li><b>Suasana (Ambiance):</b> Bagaimana warna dan cahaya berkontribusi (misal: "nada biru dingin", "cahaya senja hangat").</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-indigo-400">2. Prompting untuk Audio</h3>
                             <p class="mt-1 text-secondary">Veo3 dapat menangkap isyarat audio untuk menghasilkan soundtrack yang sinkron.</p>
                             <ul class="list-disc list-inside mt-2 space-y-1 text-secondary">
                                 <li><b>Dialog:</b> Gunakan tanda kutip untuk ucapan spesifik. (Contoh: `Pria itu bergumam, "Ini pasti kuncinya."`).</li>
                                 <li><b>Efek Suara (SFX):</b> Jelaskan suara secara eksplisit. (Contoh: "terdengar suara decitan ban yang nyaring dan deru mesin.").</li>
                                 <li><b>Suara Sekitar (Ambient Noise):</b> Deskripsikan lanskap suara lingkungan. (Contoh: "Dengungan samar yang menakutkan bergema di latar belakang.").</li>
                             </ul>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-indigo-400">3. Menggunakan Gambar Referensi (Image-to-Video)</h3>
                            <p class="mt-1 text-secondary">Anda dapat menganimasikan objek, menghidupkan gambar, dan menambahkan gerakan ke pemandangan dengan menggunakan gambar sebagai titik awal. Veo akan menggunakan foto tersebut sebagai frame pertama video Anda.</p>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-indigo-400">4. Prompt Negatif</h3>
                            <p class="mt-1 text-secondary">Tentukan elemen yang <strong>tidak</strong> Anda inginkan dalam video. Cara terbaik adalah dengan mendeskripsikan apa yang tidak ingin Anda lihat, bukan menggunakan bahasa instruktif.</p>
                            <div class="grid md:grid-cols-2 gap-4 mt-2">
                                <div class="negative-prompt-box">
                                    <h4 class="font-semibold">‚ùå JANGAN GUNAKAN:</h4>
                                    <p class="text-sm">Bahasa instruktif seperti "tidak ada" atau "jangan". Contoh: "tidak ada dinding".</p>
                                </div>
                                <div class="positive-prompt-box">
                                    <h4 class="font-semibold">‚úÖ GUNAKAN:</h4>
                                    <p class="text-sm">Deskripsikan apa yang ingin dihindari. Contoh: "-negative_prompt 'dinding, bingkai, bangunan'".</p>
                                </div>
                             </div>
                        </div>
                        <h3 class="text-2xl font-bold mt-8 mb-4">Contoh Prompt Video: Dari Sederhana ke Detail</h3>
                        <div class="space-y-4">
                            <div class="prompt-card p-4">
                                <h4 class="font-semibold">Contoh: Macan Tutul Salju</h4>
                                <p class="text-sm mt-2 mb-1 text-secondary">Prompt Sederhana:</p>
                                <p class="font-mono p-2 rounded-md text-xs">"Makhluk lucu dengan bulu seperti macan tutul salju sedang berjalan di hutan musim dingin, render gaya kartun 3D."</p>
                                <p class="text-sm mt-3 mb-1 text-secondary">Prompt Detail (Hasil Lebih Baik):</p>
                                <p class="font-mono p-2 rounded-md text-xs">"Buat adegan animasi 3D pendek dengan gaya kartun yang ceria. Makhluk lucu dengan bulu seperti macan tutul salju, mata besar yang ekspressif, dan bentuk bulat yang ramah, dengan gembira melompat-lompat melalui hutan musim dingin yang aneh. Adegan ini harus menampilkan pohon-pohon bulat yang tertutup salju, kepingan salju yang turun dengan lembut, dan sinar matahari hangat yang menyaring melalui cabang-cabang. Gerakan makhluk yang memantul dan senyum lebarnya harus menyampaikan kegembiraan murni."</p>
                            </div>
                             <div class="prompt-card p-4">
                                <h4 class="font-semibold">Contoh: Adegan Sinematik</h4>
                                <p class="text-sm mt-2 mb-1 text-secondary">Prompt Kurang Detail:</p>
                                <p class="font-mono p-2 rounded-md text-xs">"Kamera dolly untuk menunjukkan close up seorang pria putus asa dengan jas hujan hijau. Dia sedang menelepon di telepon putar dinding dengan lampu neon hijau. Terlihat seperti adegan film."</p>
                                <p class="text-sm mt-3 mb-1 text-secondary">Prompt Detail (Hasil Lebih Baik):</p>
                                <p class="font-mono p-2 rounded-md text-xs">"Sebuah shot sinematik close-up mengikuti seorang pria putus asa dengan jas hujan hijau yang usang saat dia memutar telepon putar yang terpasang di dinding bata yang kotor, bermandikan cahaya menakutkan dari papan neon hijau. Kamera dolly masuk, memperlihatkan ketegangan di rahangnya dan keputusasaan yang terukir di wajahnya saat dia berjuang untuk menelepon. Kedalaman bidang yang dangkal berfokus pada alisnya yang berkerut dan telepon putar hitam, mengaburkan latar belakang menjadi lautan warna neon dan bayangan yang tidak jelas, menciptakan rasa urgensi dan isolasi."</p>
                            </div>
                        </div>
                    </div>
                </article>
                 <article class="card p-6 md:p-8">
                    <h2 class="text-3xl font-bold mb-4">Materi 3: Menciptakan Karakter yang Konsisten</h2>
                    <p class="mb-6 text-secondary">Salah satu tantangan terbesar dalam AI generatif adalah menjaga agar karakter yang sama muncul secara konsisten di berbagai gambar. Kuncinya adalah membuat **"Character Sheet"**, sebuah prompt dasar super detail yang menjadi fondasi karakter Anda.</p>
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-2xl font-bold">Konsep "Character Sheet"</h3>
                            <p class="mt-2 text-secondary">Anggap "Character Sheet" sebagai resep atau DNA dari karakter Anda. Semakin spesifik resep awalnya, semakin mudah bagi AI untuk 'mengingat' dan mereplikasi karakter tersebut di berbagai skenario. Prompt ini selalu digunakan sebagai bagian awal dari setiap prompt baru yang melibatkan karakter tersebut.</p>
                            
                            <div class="mt-4 space-y-6">
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">Contoh "Character Sheet" yang Efektif</h4>
                                    <p class="text-sm mb-2 text-secondary">Gunakan format `(character sheet: ...)` untuk membantu AI mengenali fondasi karakter Anda. Berikan detail sebanyak mungkin.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">(character sheet: seorang wanita bernama "Aria", 25 tahun, ras asia, rambut hitam panjang lurus dengan highlight ungu, mata coklat tajam, postur atletis. Pakaian khasnya adalah jaket kulit hitam di atas kaos band metal, celana kargo, dan sepatu boots tempur. Gaya visual: ilustrasi anime modern, pencahayaan sinematik, detail tinggi)</p>
                                </div>
                                <div class="prompt-card p-4">
                                    <h4 class="font-semibold">Contoh Penggunaan dalam Skenario</h4>
                                    <p class="text-sm mb-2 text-secondary">Setelah Anda memiliki "Character Sheet", Anda hanya perlu menambah deskripsi adegan atau aksi. Selalu sertakan "Character Sheet" lengkap di awal.</p>
                                    <p class="font-mono p-3 rounded-md text-sm">**(character sheet: ...detail lengkap Aria...)** sedang berdiri di atap gedung pencakar langit saat hujan di malam hari, memandang ke bawah ke jalanan kota neon.</p>
                                    <p class="font-mono p-3 rounded-md text-sm mt-2">**(character sheet: ...detail lengkap Aria...)** sedang duduk di kafe yang remang-remang, melihat laptopnya dengan ekspresi fokus.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            </section>
            <section id="content-desainer" class="content-section">
                <div class="card p-6 md:p-8">
                     <h2 class="text-3xl font-bold mb-2">Desainer Prompt Bisnis</h2>
                     <p class="mb-6 text-secondary">Rancang prompt profesional untuk kebutuhan bisnis Anda. Pilih jenis output dan isi form di bawah ini.</p>
                    <div class="flex border-b border-border-color mb-6">
                        <button id="designer-tab-image" class="designer-tab-button active">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                            Gambar (Nano Banana)
                        </button>
                        <button id="designer-tab-video" class="designer-tab-button">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 001.553.832l3-2a1 1 0 000-1.664l-3-2z" /></svg>
                            Video (Veo3)
                        </button>
                    </div>
                     <div class="grid md:grid-cols-2 gap-8">
                         <div class="space-y-5">
                            <div id="image-designer-form" class="designer-form active">
                                <div id="standard-image-form">
                                    <div id="tujuan-gambar-container">
                                        <label for="tujuan-gambar" class="block mb-2 text-sm font-medium text-secondary">1. Apa Tujuan Utama Anda?</label>
                                        <select id="tujuan-gambar" class="form-select w-full p-2.5">
                                            <optgroup label="Buat Gambar Baru (Text-to-Image)">
                                                <option value="produk" selected>Fotografi Produk & Mockup</option>
                                                <option value="packaging">Desain Kemasan (Packaging)</option>
                                                <option value="pemasaran">Aset Pemasaran & Media Sosial</option>
                                                <option value="logo">Desain Logo & Ikon</option>
                                                <option value="ilustrasi">Ilustrasi & Seni Konsep</option>
                                            </optgroup>
                                            <optgroup label="Edit & Kreasi Lanjutan">
                                                <option value="edit">Edit & Sempurnakan Foto</option>
                                                <option value="gabungkan">Gabungkan Beberapa Foto</option>
                                                <option value="karakter">Buat Karakter Konsisten</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div id="single-upload-container" class="space-y-3 mt-5">
                                        <label id="upload-label" class="block text-sm font-medium text-secondary">Opsional: Upload Gambar untuk Diedit/Dianalisa</label>
                                        <div id="drop-zone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md cursor-pointer transition-colors border-border-color hover:border-accent-color">
                                            <div class="space-y-1 text-center">
                                                <svg class="mx-auto h-12 w-12 text-secondary" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                                <div class="flex text-sm text-secondary">
                                                    <label for="image-upload" class="relative cursor-pointer rounded-md font-medium text-indigo-400 hover:text-indigo-500"><span>UPLOAD SEBUAH FILE</span><input id="image-upload" name="image-upload" type="file" class="sr-only" accept="image/*"></label>
                                                    <p class="pl-1">atau tarik dan lepas</p>
                                                </div>
                                                <p class="text-xs text-secondary">PNG, JPG, GIF</p>
                                            </div>
                                        </div>
                                    </div>
                                     <div id="kemasan-container" class="hidden mt-5">
                                        <label for="jenis-kemasan" class="block mb-2 text-sm font-medium text-secondary"><span class="form-num">2.</span> Pilih Jenis Kemasan</label>
                                        <select id="jenis-kemasan" class="form-select w-full p-2.5">
                                            <option>Kotak Karton</option><option>Standing Pouch</option><option>Botol Kaca / Plastik</option><option>Paper Bowl / Cup</option><option>Kaleng</option><option>Sachet</option><option>Blister Pack</option><option>Vacuum Pack</option><option>Besek Bambu</option><option>Kotak Kayu</option><option>Tube / Tabung</option><option>Jar (Toples)</option><option>Tray</option><option>Wrap Pembungkus Kertas / Aluminium</option><option>Drum / Pail</option><option>Envelope Pack</option>
                                        </select>
                                    </div>
                                    <div class="mt-5">
                                        <label for="produk-gambar" class="block mb-2 text-sm font-medium text-secondary"><span class="form-num">2.</span> <span id="produk-gambar-label-text">Apa Objek atau Produk Utamanya?</span></label>
                                        <input type="text" id="produk-gambar" class="form-input w-full p-2.5" placeholder="Contoh: sebotol madu hutan, sepatu lari">
                                    </div>
                                    <div class="mt-5">
                                        <label for="gaya-gambar" class="block mb-2 text-sm font-medium text-secondary"><span class="form-num">3.</span> <span id="gaya-gambar-label-text">Apa Gaya Visual yang Diinginkan?</span></label>
                                        <input type="text" id="gaya-gambar" class="form-input w-full p-2.5" placeholder="Contoh: minimalis & bersih, mewah & elegan">
                                    </div>
                                    <div class="mt-5">
                                        <label for="latar-belakang-gambar" class="block mb-2 text-sm font-medium text-secondary"><span class="form-num">4.</span> <span id="latar-belakang-gambar-label-text">Bagaimana Latar Belakangnya?</span></label>
                                        <input type="text" id="latar-belakang-gambar" class="form-input w-full p-2.5" placeholder="Contoh: di atas meja kayu, studio putih, pantai saat senja">
                                    </div>
                                     <div class="mt-5">
                                        <label for="detail-gambar" class="block mb-2 text-sm font-medium text-secondary"><span class="form-num">5.</span> <span id="detail-gambar-label-text">Detail Tambahan (Opsional)</span></label>
                                        <textarea id="detail-gambar" rows="4" class="form-input w-full p-2.5" placeholder="Contoh: percikan air, ada buah jeruk di sampingnya"></textarea>
                                    </div>
                                </div>

                                 <div id="image-composition-form" class="hidden space-y-5">
                                     <button id="back-to-tujuan-button" class="text-sm text-indigo-400 hover:underline mb-4 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                                        </svg>
                                        Kembali ke Pilihan Tujuan
                                     </button>
                                     <div>
                                         <label class="block text-sm font-medium text-secondary">1. Upload Foto Pertama (Objek/Subjek Utama)</label>
                                         <div id="drop-zone-compose-1" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md cursor-pointer transition-colors border-border-color hover:border-accent-color">
                                             <div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-secondary" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-secondary"><label for="image-upload-compose-1" class="relative cursor-pointer rounded-md font-medium text-indigo-400 hover:text-indigo-500"><span>UPLOAD FOTO 1</span><input id="image-upload-compose-1" type="file" class="sr-only" accept="image/*"></label><p class="pl-1">atau tarik & lepas</p></div></div>
                                         </div>
                                     </div>
                                     <div>
                                         <label class="block text-sm font-medium text-secondary">2. Upload Foto Kedua (Latar/Gaya)</label>
                                         <div id="drop-zone-compose-2" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md cursor-pointer transition-colors border-border-color hover:border-accent-color">
                                             <div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-secondary" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-secondary"><label for="image-upload-compose-2" class="relative cursor-pointer rounded-md font-medium text-indigo-400 hover:text-indigo-500"><span>UPLOAD FOTO 2</span><input id="image-upload-compose-2" type="file" class="sr-only" accept="image/*"></label><p class="pl-1">atau tarik & lepas</p></div></div>
                                         </div>
                                     </div>
                                     <div>
                                         <label for="composition-details" class="block mb-2 text-sm font-medium text-secondary">3. Jelaskan Cara Menggabungkannya</label>
                                         <textarea id="composition-details" rows="4" class="form-input w-full p-2.5" placeholder="Contoh: Ambil orang dari foto 1 dan letakkan di pantai dari foto 2."></textarea>
                                     </div>
                                 </div>

                                 <div id="character-creator-form" class="hidden space-y-5">
                                     <button id="back-to-tujuan-button-char" class="text-sm text-indigo-400 hover:underline mb-4 flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                                        </svg>
                                        Kembali ke Pilihan Tujuan
                                     </button>
                                     <div>
                                         <label class="block text-sm font-medium text-secondary">Opsional: Upload Gambar Referensi Karakter</label>
                                         <div id="drop-zone-char" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md cursor-pointer transition-colors border-border-color hover:border-accent-color">
                                             <div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-secondary" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><div class="flex text-sm text-secondary"><label for="image-upload-char" class="relative cursor-pointer rounded-md font-medium text-indigo-400 hover:text-indigo-500"><span>UPLOAD FOTO REFERENSI</span><input id="image-upload-char" name="image-upload-char" type="file" class="sr-only" accept="image/*"></label><p class="pl-1">atau tarik & lepas</p></div></div>
                                         </div>
                                         <div id="character-preview-container" class="hidden mt-4 space-y-3">
                                            <div class="relative w-full md:w-2/3 mx-auto">
                                                <img id="uploaded-char-preview" src="" alt="Character Reference Preview" class="rounded-lg shadow-md object-contain">
                                                <button id="remove-char-image-button" class="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-sm leading-none">√ó</button>
                                            </div>
                                            <button id="analyze-char-button" class="btn btn-secondary w-full px-3 py-1.5 text-sm">
                                                <span id="analyze-char-icon">ü§ñ</span>
                                                <span id="analyze-char-text">ANALISA KARAKTER & ISI FORM</span>
                                            </button>
                                        </div>
                                     </div>
                                     <div>
                                        <label for="char-name" class="block mb-2 text-sm font-medium text-secondary">1. Nama/ID Karakter</label>
                                        <input type="text" id="char-name" class="form-input w-full p-2.5" placeholder="Contoh: Aria, Detektif Cyberpunk">
                                     </div>
                                     <div>
                                        <label for="char-physic" class="block mb-2 text-sm font-medium text-secondary">2. Ciri-Ciri Fisik Utama</label>
                                        <textarea id="char-physic" rows="3" class="form-input w-full p-2.5" placeholder="Contoh: Wanita Asia 25 tahun, rambut hitam panjang lurus dengan highlight ungu, mata tajam"></textarea>
                                     </div>
                                      <div>
                                        <label for="char-attire" class="block mb-2 text-sm font-medium text-secondary">3. Pakaian Khas</label>
                                        <textarea id="char-attire" rows="3" class="form-input w-full p-2.5" placeholder="Contoh: Jaket kulit hitam, kaos band, celana kargo, boots tempur"></textarea>
                                     </div>
                                     <div>
                                        <label for="char-style" class="block mb-2 text-sm font-medium text-secondary">4. Gaya Artistik</label>
                                        <input type="text" id="char-style" class="form-input w-full p-2.5" placeholder="Contoh: Ilustrasi anime sinematik, fotorealistis">
                                     </div>
                                 </div>
                             </div>
                             <div id="video-designer-form" class="designer-form space-y-5">
                                 <div class="space-y-3">
                                     <label class="block text-sm font-medium text-secondary">Opsional: Upload Gambar Referensi (Image-to-Video)</label>
                                     <div id="drop-zone-video" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md cursor-pointer transition-colors border-border-color hover:border-accent-color">
                                         <div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-secondary" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg><div class="flex text-sm text-secondary"><label for="image-upload-video" class="relative cursor-pointer rounded-md font-medium text-indigo-400 hover:text-indigo-500"><span>UPLOAD SEBUAH FILE</span><input id="image-upload-video" name="image-upload-video" type="file" class="sr-only" accept="image/*"></label><p class="pl-1">atau tarik dan lepas</p></div></div>
                                     </div>
                                 </div>
                                 <div>
                                     <label for="subjek-video-subject" class="block mb-2 text-sm font-medium text-secondary">1. Subjek</label>
                                     <input type="text" id="subjek-video-subject" class="form-input w-full p-2.5" placeholder="Contoh: Seorang wanita, seekor naga api">
                                 </div>
                                  <div>
                                     <label for="subjek-video-action" class="block mb-2 text-sm font-medium text-secondary">2. Aksi Utama</label>
                                     <textarea id="subjek-video-action" rows="2" class="form-input w-full p-2.5" placeholder="Contoh: berjalan di pantai saat matahari terbenam."></textarea>
                                 </div>
                                 <div>
                                     <label for="latar-belakang-video" class="block mb-2 text-sm font-medium text-secondary">3. Latar Belakang</label>
                                     <input type="text" id="latar-belakang-video" class="form-input w-full p-2.5" placeholder="Contoh: di sebuah kota cyberpunk yang ramai, di hutan berkabut">
                                 </div>
                                 <div>
                                     <label for="gaya-video" class="block mb-2 text-sm font-medium text-secondary">4. Gaya, Kamera & Suasana</label>
                                     <input type="text" id="gaya-video" class="form-input w-full p-2.5" placeholder="Contoh: Gaya film noir, wide shot, dolly in, nada biru dingin">
                                 </div>
                                 <div>
                                     <label for="audio-video" class="block mb-2 text-sm font-medium text-secondary">5. Detail Audio (Dialog, Musik, SFX)</label>
                                     <textarea id="audio-video" rows="3" class="form-input w-full p-2.5" placeholder="Contoh: Dia berkata, ‚ÄúAku menemukannya.‚Äù Musik: lo-fi. SFX: deburan ombak."></textarea>
                                 </div>
                                 <div>
                                     <label for="negatif-video" class="block mb-2 text-sm font-medium text-secondary">6. Prompt Negatif (Elemen yang Dihindari)</label>
                                     <input type="text" id="negatif-video" class="form-input w-full p-2.5" placeholder="Contoh: bangunan, orang lain, tulisan">
                                 </div>
                             </div>
                         </div>
                         <div class="space-y-6">
                             <div id="image-preview-container" class="hidden space-y-3">
                                 <h4 class="text-md font-semibold">Preview & Analisa Gambar Referensi</h4>
                                 <div class="flex flex-col md:flex-row items-start gap-4">
                                     <div class="relative w-full md:w-1/3">
                                         <img id="uploaded-image-preview" src="" alt="Uploaded Image Preview" class="rounded-lg shadow-md object-contain">
                                         <button id="remove-image-button" class="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-sm leading-none">&times;</button>
                                     </div>
                                     <div class="w-full md:w-2/3">
                                         <button id="analyze-image-button" class="btn btn-secondary w-full px-3 py-1.5 text-sm mb-2">
                                             <span id="analyze-image-icon">üîç</span>
                                             <span id="analyze-image-text">ANALISA GAMBAR</span>
                                         </button>
                                         <textarea id="image-analysis-result" rows="6" class="form-input w-full p-2.5 text-xs" placeholder="Hasil analisa gambar oleh AI akan muncul di sini..."></textarea>
                                     </div>
                                 </div>
                                  <hr class="border-border-color">
                             </div>
                             
                             <div id="composition-preview-container" class="hidden space-y-3">
                                <h4 class="text-md font-semibold">Preview Foto untuk Digabungkan</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="relative">
                                        <img id="uploaded-compose-preview-1" src="" alt="Preview 1" class="rounded-lg shadow-md object-contain w-full h-auto">
                                        <button id="remove-compose-1" class="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-sm leading-none">&times;</button>
                                    </div>
                                    <div class="relative">
                                        <img id="uploaded-compose-preview-2" src="" alt="Preview 2" class="rounded-lg shadow-md object-contain w-full h-auto">
                                        <button id="remove-compose-2" class="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-sm leading-none">&times;</button>
                                    </div>
                                </div>
                                <hr class="border-border-color">
                             </div>

                             <div id="character-output-section" class="hidden space-y-4">
                                <div>
                                    <label for="character-sheet-output" class="block mb-2 text-sm font-medium text-secondary">Character Sheet (Untuk Disimpan)</label>
                                    <textarea id="character-sheet-output" rows="5" class="form-input w-full p-2.5 text-xs"></textarea>
                                </div>
                                <div>
                                    <label for="character-scenario-input" class="block mb-2 text-sm font-medium text-secondary">Masukkan Skenario atau Aksi</label>
                                    <input type="text" id="character-scenario-input" class="form-input w-full p-2.5" placeholder="Contoh: berdiri di atap gedung saat hujan">
                                </div>
                             </div>

                              <div id="video-preview-container" class="hidden space-y-3">
                                 <h4 class="text-md font-semibold">Preview Gambar Referensi Video</h4>
                                  <div class="relative w-full">
                                     <img id="uploaded-video-preview" src="" alt="Uploaded Video Reference Preview" class="w-full rounded-lg shadow-md object-contain max-h-48 mx-auto">
                                     <button id="remove-video-button" class="absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full h-6 w-6 flex items-center justify-center font-bold text-sm leading-none">&times;</button>
                                  </div>
                                  <div class="w-full mt-4">
                                        <button id="analyze-video-image-button" class="btn btn-secondary w-full px-3 py-1.5 text-sm mb-2">
                                            <span id="analyze-video-image-text">ANALISA GAMBAR & ISI FORM</span>
                                        </button>
                                        <textarea id="video-image-analysis-result" rows="4" class="form-input w-full p-2.5 text-xs hidden" placeholder="Hasil analisa gambar oleh AI akan muncul di sini..."></textarea>
                                    </div>
                                 <hr class="border-border-color">
                             </div>
                             <div>
                                <label for="aspect-ratio-button" class="block mb-2 text-sm font-medium text-secondary">Pilih Aspek Rasio</label>
                                <div class="relative" id="aspect-ratio-dropdown">
                                    <button type="button" id="aspect-ratio-button" class="form-select w-full p-2.5 flex items-center justify-between text-left">
                                    </button>
                                    <div id="aspect-ratio-menu" class="hidden absolute z-10 w-full mt-1 bg-primary-solid border border-border-color rounded-md shadow-lg">
                                        <ul class="max-h-60 overflow-auto rounded-md py-1 text-base">
                                            <li class="aspect-ratio-option" data-ratio="1:1" data-label="Post">
                                                <svg viewBox="0 0 20 20"><rect x="3" y="3" width="14" height="14" rx="2"/></svg>
                                                <span>1:1 <span class="text-secondary ml-2">Post</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="4:5" data-label="Portrait">
                                                <svg viewBox="0 0 20 25"><rect x="4" y="3" width="12" height="19" rx="2"/></svg>
                                                <span>4:5 <span class="text-secondary ml-2">Portrait</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="9:16" data-label="Stories">
                                                <svg viewBox="0 0 18 32"><rect x="4" y="3" width="10" height="26" rx="2"/></svg>
                                                <span>9:16 <span class="text-secondary ml-2">Stories</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="16:9" data-label="YouTube">
                                                <svg viewBox="0 0 32 18"><rect x="3" y="4" width="26" height="10" rx="2"/></svg>
                                                <span>16:9 <span class="text-secondary ml-2">YouTube</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="1.91:1" data-label="Ads">
                                                <svg viewBox="0 0 30.56 16"><rect x="3" y="4" width="24.56" height="8" rx="2"/></svg>
                                                <span>1.91:1 <span class="text-secondary ml-2">Ads</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="4:3" data-label="Digital">
                                                <svg viewBox="0 0 20 15"><rect x="3" y="3" width="14" height="9" rx="2"/></svg>
                                                <span>4:3 <span class="text-secondary ml-2">Digital</span></span>
                                            </li>
                                            <li class="aspect-ratio-option" data-ratio="3:4" data-label="Print">
                                                <svg viewBox="0 0 15 20"><rect x="3" y="3" width="9" height="14" rx="2"/></svg>
                                                <span>3:4 <span class="text-secondary ml-2">Print</span></span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                             </div>
                              <div id="final-prompt-container">
                                 <div class="flex justify-between items-center mb-2">
                                     <h3 class="text-lg font-semibold">Hasil Prompt:</h3>
                                     <button id="enhance-prompt-button" class="btn btn-primary px-3 py-1.5 text-xs">
                                         <span id="enhance-prompt-text">SEMPURNAKAN PROMPT</span>
                                     </button>
                                 </div>
                                 <div class="relative">
                                     <textarea id="output-prompt" rows="8" class="form-input w-full p-2.5 pr-24"></textarea>
                                     <button id="copy-button" class="absolute top-2 right-2 btn btn-secondary px-3 py-1.5 text-xs">SALIN</button>
                                 </div>
                             </div>
                         </div>
                     </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-12 text-secondary text-sm">
            <p>&copy; 2025 Prompt Engineering Studio. Oleh ISPARMO Powered by AI.</p>
        </footer>
    </div>

    <button id="assistant-button" class="hidden text-accent-text fixed bottom-8 right-8 rounded-full shadow-lg z-50 flex items-center justify-center w-14 h-14">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.51c1.136-1.01 2.894-1.01 4.03 0 1.135 1.01.99 2.768-.336 3.878-1.325 1.11-2.438 2.388-2.438 3.96v.152" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75h.01" />
        </svg>
    </button>

    <div id="assistant-modal" class="hidden fixed bottom-28 right-8 w-full max-w-sm h-[60vh] rounded-lg shadow-2xl z-50 flex flex-col transition-all duration-300 ease-out transform opacity-0 translate-y-4">
        <div class="flex justify-between items-center p-4 border-b border-border-color bg-tertiary rounded-t-lg">
            <h3 class="font-bold text-base">Asisten Ahli Prompt</h3>
            <button id="close-assistant-modal" class="text-2xl font-bold leading-none hover:text-primary">&times;</button>
        </div>
        <div id="assistant-chat-body" class="flex-1 p-4 space-y-4">
            <!-- Messages will be appended here -->
        </div>
        <div class="p-4 border-t border-border-color">
            <div class="relative">
                <input type="text" id="assistant-input" class="form-input w-full p-3 pr-14" placeholder="Tanya sesuatu...">
                <button id="send-assistant-message" class="absolute right-1 top-1/2 -translate-y-1.2 btn btn-primary !p-2">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        let userApiKey = null;
        let apiMode = 'shared';
        let uploadedImageBase64 = null;
        let composeImage1Base64 = null;
        let composeImage2Base64 = null;
        let characterRefImageBase64 = null;
        let videoRefImageFile = null;
        let videoRefImageBase64 = null;
        let selectedAspectRatio = '1:1';
        
        const elements = {
            welcomeScreen: document.getElementById('welcome-screen'),
            mainApp: document.getElementById('main-app'),
            useSharedEnvBtn: document.getElementById('use-shared-env'),
            useUserApiKeyBtn: document.getElementById('use-user-api-key'),
            apiKeySection: document.getElementById('api-key-section'),
            apiKeyInput: document.getElementById('api-key-input'),
            startWithApiKeyBtn: document.getElementById('start-with-api-key'),
            assistantButton: document.getElementById('assistant-button'),
            themeToggle: document.getElementById('theme-toggle'),
            lightIcon: document.getElementById('theme-icon-light'),
            darkIcon: document.getElementById('theme-icon-dark'),
            mainTabButtons: {
                belajar: document.getElementById('tab-belajar'),
                desainer: document.getElementById('tab-desainer')
            },
            contentSections: {
                belajar: document.getElementById('content-belajar'),
                desainer: document.getElementById('content-desainer')
            },
            designerTabImage: document.getElementById('designer-tab-image'),
            designerTabVideo: document.getElementById('designer-tab-video'),
            imageForm: document.getElementById('image-designer-form'),
            videoForm: document.getElementById('video-designer-form'),
            outputPromptEl: document.getElementById('output-prompt'),
            copyButton: document.getElementById('copy-button'),
            standardImageForm: document.getElementById('standard-image-form'),
            tujuanGambarContainer: document.getElementById('tujuan-gambar-container'),
            tujuanGambarEl: document.getElementById('tujuan-gambar'),
            kemasanContainerEl: document.getElementById('kemasan-container'),
            jenisKemasanEl: document.getElementById('jenis-kemasan'),
            produkGambarEl: document.getElementById('produk-gambar'),
            gayaGambarEl: document.getElementById('gaya-gambar'),
            latarBelakangGambarEl: document.getElementById('latar-belakang-gambar'),
            detailGambarEl: document.getElementById('detail-gambar'),
            produkGambarLabelText: document.getElementById('produk-gambar-label-text'),
            gayaGambarLabelText: document.getElementById('gaya-gambar-label-text'),
            detailGambarLabelText: document.getElementById('detail-gambar-label-text'),
            singleUploadContainer: document.getElementById('single-upload-container'),
            uploadLabel: document.getElementById('upload-label'),
            imageCompositionForm: document.getElementById('image-composition-form'),
            compositionDetailsEl: document.getElementById('composition-details'),
            compositionPreviewContainer: document.getElementById('composition-preview-container'),
            backToTujuanButton: document.getElementById('back-to-tujuan-button'),
            characterCreatorForm: document.getElementById('character-creator-form'),
            backToTujuanButtonChar: document.getElementById('back-to-tujuan-button-char'),
            charNameEl: document.getElementById('char-name'),
            charPhysicEl: document.getElementById('char-physic'),
            charAttireEl: document.getElementById('char-attire'),
            charStyleEl: document.getElementById('char-style'),
            characterOutputSection: document.getElementById('character-output-section'),
            characterSheetOutputEl: document.getElementById('character-sheet-output'),
            characterScenarioInputEl: document.getElementById('character-scenario-input'),
            subjekVideoSubjectEl: document.getElementById('subjek-video-subject'),
            subjekVideoActionEl: document.getElementById('subjek-video-action'),
            latarBelakangVideoEl: document.getElementById('latar-belakang-video'),
            gayaVideoEl: document.getElementById('gaya-video'),
            audioVideoEl: document.getElementById('audio-video'),
            negatifVideoEl: document.getElementById('negatif-video'),
            allFormInputs: document.querySelectorAll('.form-input:not(#output-prompt):not(#character-sheet-output):not(#image-analysis-result):not(#video-image-analysis-result), .form-select'),
            enhanceButton: document.getElementById('enhance-prompt-button'),
            finalPromptContainer: document.getElementById('final-prompt-container'),
            imageUploadEl: document.getElementById('image-upload'),
            dropZone: document.getElementById('drop-zone'),
            imagePreviewContainer: document.getElementById('image-preview-container'),
            uploadedImagePreview: document.getElementById('uploaded-image-preview'),
            analyzeImageButton: document.getElementById('analyze-image-button'),
            analyzeImageText: document.getElementById('analyze-image-text'),
            analyzeImageIcon: document.getElementById('analyze-image-icon'),
            imageAnalysisResult: document.getElementById('image-analysis-result'),
            removeImageButton: document.getElementById('remove-image-button'),
            imageUploadCompose1: document.getElementById('image-upload-compose-1'),
            dropZoneCompose1: document.getElementById('drop-zone-compose-1'),
            uploadedComposePreview1: document.getElementById('uploaded-compose-preview-1'),
            removeCompose1: document.getElementById('remove-compose-1'),
            imageUploadCompose2: document.getElementById('image-upload-compose-2'),
            dropZoneCompose2: document.getElementById('drop-zone-compose-2'),
            uploadedComposePreview2: document.getElementById('uploaded-compose-preview-2'),
            removeCompose2: document.getElementById('remove-compose-2'),
            imageUploadChar: document.getElementById('image-upload-char'),
            dropZoneChar: document.getElementById('drop-zone-char'),
            characterPreviewContainer: document.getElementById('character-preview-container'),
            uploadedCharPreview: document.getElementById('uploaded-char-preview'),
            removeCharImageButton: document.getElementById('remove-char-image-button'),
            analyzeCharButton: document.getElementById('analyze-char-button'),
            analyzeCharText: document.getElementById('analyze-char-text'),
            analyzeCharIcon: document.getElementById('analyze-char-icon'),
            imageUploadVideoEl: document.getElementById('image-upload-video'),
            dropZoneVideo: document.getElementById('drop-zone-video'),
            videoPreviewContainer: document.getElementById('video-preview-container'),
            uploadedVideoPreview: document.getElementById('uploaded-video-preview'),
            removeVideoButton: document.getElementById('remove-video-button'),
            analyzeVideoImageButton: document.getElementById('analyze-video-image-button'),
            analyzeVideoImageText: document.getElementById('analyze-video-image-text'),
            analyzeVideoImageIcon: document.getElementById('analyze-video-image-icon'),
            videoImageAnalysisResult: document.getElementById('video-image-analysis-result'),
            aspectRatioDropdown: document.getElementById('aspect-ratio-dropdown'),
            aspectRatioButton: document.getElementById('aspect-ratio-button'),
            aspectRatioMenu: document.getElementById('aspect-ratio-menu'),
            aspectRatioOptions: document.querySelectorAll('.aspect-ratio-option'),
            assistantModal: document.getElementById('assistant-modal'),
            closeAssistantModal: document.getElementById('close-assistant-modal'),
            assistantChatBody: document.getElementById('assistant-chat-body'),
            assistantInput: document.getElementById('assistant-input'),
            sendAssistantMessage: document.getElementById('send-assistant-message'),
        };

        // --- Functions ---
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                elements.lightIcon.classList.add('hidden');
                elements.darkIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                elements.lightIcon.classList.remove('hidden');
                elements.darkIcon.classList.add('hidden');
            }
        };

        function showTab(tabName) {
            Object.values(elements.mainTabButtons).forEach(button => button.classList.remove('active'));
            elements.mainTabButtons[tabName].classList.add('active');
            Object.values(elements.contentSections).forEach(section => section.classList.remove('active'));
            elements.contentSections[tabName].classList.add('active');
        }
        
        function switchDesignerTab(tab) {
            if (tab === 'image') {
                elements.designerTabImage.classList.add('active');
                elements.designerTabVideo.classList.remove('active');
                elements.imageForm.classList.add('active');
                elements.videoForm.classList.remove('active');
            } else {
                elements.designerTabImage.classList.remove('active');
                elements.designerTabVideo.classList.add('active');
                elements.imageForm.classList.remove('active');
                elements.videoForm.classList.add('active');
            }
            elements.imagePreviewContainer.classList.toggle('hidden', tab !== 'image' || !uploadedImageBase64);
            elements.videoPreviewContainer.classList.toggle('hidden', tab !== 'video' || !videoRefImageFile);
            updateGeneratedPrompt();
        }

        function generateCharacterPrompt() {
            const name = elements.charNameEl.value.trim();
            const physic = elements.charPhysicEl.value.trim();
            const attire = elements.charAttireEl.value.trim();
            const style = elements.charStyleEl.value.trim();
            const scenario = elements.characterScenarioInputEl.value.trim();

            let sheet = `(character sheet: ${name || '[Nama Karakter]'}.`;
            if (physic) sheet += ` Ciri fisik: ${physic}.`;
            if (attire) sheet += ` Pakaian khas: ${attire}.`;
            if (style) sheet += ` Gaya visual: ${style}.`;
            sheet += ')';

            elements.characterSheetOutputEl.value = sheet;
            elements.outputPromptEl.value = `${sheet} ${scenario || '[Skenario/Aksi]'}. Aspek rasio ${selectedAspectRatio}.`.trim();
        }

        function generateImagePrompt() {
            const tujuan = elements.tujuanGambarEl.value;
            
            if (tujuan === 'gabungkan') {
                const details = elements.compositionDetailsEl.value.trim();
                let prompt = "Buat gambar baru dengan menggabungkan elemen dari gambar yang disediakan. ";
                prompt += details || "[Jelaskan cara menggabungkan foto 1 dan 2]";
                elements.outputPromptEl.value = (prompt + ` Aspek rasio ${selectedAspectRatio}.`).trim();
                return;
            }

            if (tujuan === 'karakter') {
                generateCharacterPrompt();
                return;
            }

            const isEditing = tujuan === 'edit';
            const produk = elements.produkGambarEl.value.trim();
            const gaya = elements.gayaGambarEl.value.trim();
            const latar = elements.latarBelakangGambarEl.value.trim();
            const detail = elements.detailGambarEl.value.trim();
            const jenisKemasan = elements.jenisKemasanEl.value;
            let prompt = "";

            if (isEditing) {
                prompt = detail || `Sempurnakan foto dari "${produk || 'gambar ini'}", terapkan gaya visual ${gaya || 'profesional'} dan sesuaikan latar belakang menjadi ${latar || 'lebih baik'}.`;
            } else {
                 switch (tujuan) {
                    case 'produk':
                        prompt = `Sebuah foto produk profesional dari ${produk || '[Produk Anda]'} dengan latar belakang ${latar || 'yang sesuai'}. Bergaya ${gaya || '[Gaya Visual Anda]'}. ${detail}`;
                        break;
                    case 'packaging':
                        prompt = `Desain kemasan (${jenisKemasan}) untuk ${produk || '[Produk Anda]'} dengan latar belakang ${latar || 'yang menarik'}. Bergaya ${gaya || '[Gaya Visual Anda]'}. ${detail}`;
                        break;
                    case 'pemasaran':
                         prompt = `Aset pemasaran visual untuk ${produk || '[Tujuan Pemasaran Anda]'} dengan latar belakang ${latar || 'profesional'}. Bergaya ${gaya || '[Gaya Visual Anda]'}. ${detail}`;
                        break;
                    case 'logo':
                        prompt = `Desain logo untuk brand bernama "${produk || '[Nama Brand Anda]'}" dengan teks "${produk || '[Teks Logo Anda]'}". Desainnya harus bergaya ${gaya || '[Gaya Visual Anda]'} dengan latar belakang ${latar || 'sederhana'}. ${detail}`;
                        break;
                    case 'ilustrasi':
                        prompt = `Sebuah ilustrasi dari ${produk || '[Subjek Ilustrasi Anda]'} di sebuah ${latar || 'lingkungan yang imajinatif'}. Gaya seni ${gaya || '[Gaya Artistik Anda]'}. ${detail}`;
                        break;
                }
            }
            
            elements.outputPromptEl.value = (prompt + ` Aspek rasio ${selectedAspectRatio}.`).trim();
        }

        function generateVideoPrompt() {
            const subject = elements.subjekVideoSubjectEl.value.trim() || "[Subjek]";
            const action = elements.subjekVideoActionEl.value.trim() || "[Aksi]";
            const latar = elements.latarBelakangVideoEl.value.trim();
            const subjekDanAksi = `${subject} ${action}`.trim();

            const gaya = elements.gayaVideoEl.value.trim() || "[Gaya, kamera, dan suasana]";
            const audio = elements.audioVideoEl.value.trim();
            const negativo = elements.negatifVideoEl.value.trim();
            let prompt = "";
            if (videoRefImageFile) {
                prompt += "[Gambar Input] ";
            }
            prompt += `${subjekDanAksi}`;
            if (latar) {
                prompt += ` berlatar di ${latar}`;
            }
            prompt += `. ${gaya}.`;

            if (audio) {
                prompt += ` Detail audio: ${audio}.`;
            }
            prompt += ` Aspek rasio ${selectedAspectRatio}.`;
            if (negativo) {
                prompt += ` -negative_prompt "${negativo}"`;
            }
            elements.outputPromptEl.value = prompt;
        }

        function updateGeneratedPrompt() {
            if (elements.designerTabImage.classList.contains('active')) {
                generateImagePrompt();
            } else {
                generateVideoPrompt();
            }
        }
        
        function handleTujuanGambarChange() {
            const tujuan = elements.tujuanGambarEl.value;
            const isImageUploaded = uploadedImageBase64 !== null;

            // 1. Reset all form visibilities for a clean slate
            elements.standardImageForm.classList.add('hidden');
            elements.imageCompositionForm.classList.add('hidden');
            elements.characterCreatorForm.classList.add('hidden');
            elements.imagePreviewContainer.classList.add('hidden');
            elements.compositionPreviewContainer.classList.add('hidden');
            elements.characterOutputSection.classList.add('hidden');
            elements.kemasanContainerEl.classList.add('hidden');
            elements.finalPromptContainer.classList.add('hidden');

            // 2. Handle special forms that don't use the standard layout
            if (tujuan === 'gabungkan') {
                elements.imageCompositionForm.classList.remove('hidden');
                elements.compositionPreviewContainer.classList.remove('hidden');
                elements.finalPromptContainer.classList.remove('hidden');
                updateGeneratedPrompt();
                return;
            }

            if (tujuan === 'karakter') {
                elements.characterCreatorForm.classList.remove('hidden');
                elements.characterOutputSection.classList.remove('hidden');
                elements.finalPromptContainer.classList.remove('hidden');
                updateGeneratedPrompt();
                return;
            }

            // 3. For all other cases, show the standard form and final prompt area
            elements.standardImageForm.classList.remove('hidden');
            elements.finalPromptContainer.classList.remove('hidden');
            if (isImageUploaded) {
                elements.imagePreviewContainer.classList.remove('hidden');
            }

            // 4. Define all possible labels and placeholders
            const labelSets = {
                create: {
                    produk: {
                        upload: "Opsional: Upload foto produk sebagai referensi",
                        label1: "Deskripsikan Produk",
                        placeholder1: "Contoh: sebotol madu dalam jar kaca dengan tutup kayu",
                        label2: "Deskripsikan Gaya Fotografi",
                        placeholder2: "Contoh: pencahayaan studio yang bersih, minimalis",
                        label3: "Detail Latar & Suasana",
                        placeholder3: "Contoh: di atas meja marmer putih dengan properti sarang lebah",
                    },
                    packaging: {
                        upload: "Opsional: Upload gambar referensi untuk kemasan",
                        label1: "Deskripsikan Produk di Dalam Kemasan",
                        placeholder1: "Contoh: Keripik kentang pedas, sabun organik",
                        label2: "Deskripsikan Gaya Desain Kemasan",
                        placeholder2: "Contoh: playful dan berwarna, mewah dengan nuansa emas",
                        label3: "Detail Tambahan (Teks, Logo, Material)",
                        placeholder3: "Contoh: Teks 'Rasa Original', logo di tengah, material kraft paper",
                    },
                    pemasaran: {
                        upload: "Opsional: Upload gambar aset sebagai referensi",
                        label1: "Apa Tujuan Aset Pemasaran?",
                        placeholder1: "Contoh: thumbnail YouTube, post Instagram, brosur",
                        label2: "Deskripsikan Gaya Visual",
                        placeholder2: "Contoh: cerah dan menarik, korporat dan profesional",
                        label3: "Teks atau Elemen Penting Lainnya",
                        placeholder3: "Contoh: teks 'Diskon 50%', logo di pojok kanan atas",
                    },
                    logo: {
                        upload: "Opsional: Upload sketsa atau referensi logo",
                        label1: "Nama Brand & Teks pada Logo",
                        placeholder1: "Contoh: Aroma Pagi",
                        label2: "Deskripsikan Gaya Logo & Font",
                        placeholder2: "Contoh: minimalis line-art, font sans-serif modern",
                        label3: "Detail Ikon atau Simbol (Opsional)",
                        placeholder3: "Contoh: ada ikon biji kopi sederhana di atasnya",
                    },
                    ilustrasi: {
                        upload: "Opsional: Upload sketsa atau gambar referensi",
                        label1: "Deskripsikan Subjek & Adegan",
                        placeholder1: "Contoh: seorang ksatria naga di puncak gunung",
                        label2: "Deskripsikan Gaya Artistik",
                        placeholder2: "Contoh: gaya anime fantasi, cat air digital, pixel art",
                        label3: "Detail Suasana & Palet Warna",
                        placeholder3: "Contoh: suasana senja, warna dominan ungu dan oranye",
                    }
                },
                edit: {
                    upload: "Wajib: Upload foto yang ingin diedit",
                    label1: "Apa Objek Utama pada Gambar?",
                    placeholder1: "Contoh: sebuah mobil merah, potret seorang wanita",
                    label2: "Gaya Visual Baru (jika ingin diubah)",
                    placeholder2: "Contoh: ubah menjadi gaya sinematik, buat lebih cerah",
                    label3: "Jelaskan Perubahan/Penyempurnaan",
                    placeholder3: "Contoh: Ganti latar belakang menjadi pemandangan pantai",
                }
            };

            // 5. Select the correct set of labels
            const currentLabels = (tujuan === 'edit')
                ? labelSets.edit
                : labelSets.create[tujuan];

            if (!currentLabels) return; // Exit if the purpose is not found

            // 6. Apply the labels and placeholders
            elements.uploadLabel.textContent = currentLabels.upload;
            elements.produkGambarLabelText.textContent = currentLabels.label1;
            elements.produkGambarEl.placeholder = currentLabels.placeholder1;
            elements.gayaGambarLabelText.textContent = currentLabels.label2;
            elements.gayaGambarEl.placeholder = currentLabels.placeholder2;
            elements.detailGambarLabelText.textContent = currentLabels.label3;
            elements.detailGambarEl.placeholder = currentLabels.placeholder3;

            // 7. Show packaging-specific dropdown only when needed
            if (tujuan === 'packaging') {
                elements.kemasanContainerEl.classList.remove('hidden');
            }

            // Renumber the form fields
            const formFields = elements.standardImageForm.querySelectorAll('.mt-5');
            let visibleFieldIndex = 1;
            formFields.forEach(field => {
                const formNum = field.querySelector('.form-num');
                if (formNum && !field.classList.contains('hidden')) {
                     // Check if the parent of formNum has a direct child label (not nested)
                    const label = field.querySelector(':scope > label');
                    if (label && label.contains(formNum)) {
                         visibleFieldIndex++;
                         formNum.textContent = `${visibleFieldIndex}.`;
                    }
                }
            });
            
            updateGeneratedPrompt();
        }
        
        async function makeApiCallWithRetry(systemPrompt, userQuery, isJson = false) {
            const apiKey = apiMode === 'user' ? userApiKey : ""; 
            if (apiMode === 'user' && !apiKey) {
                 throw new Error("API Key pengguna tidak valid atau tidak tersedia.");
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            if (isJson) {
                 payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "name": { "type": "STRING" },
                            "physic": { "type": "STRING" },
                            "attire": { "type": "STRING" },
                            "style": { "type": "STRING" }
                        },
                        required: ["name", "physic", "attire", "style"]
                    }
                }
            }


            for (let i = 0; i < 3; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                        return result.candidates[0].content.parts[0].text;
                    } else { throw new Error("Invalid API response structure"); }
                } catch (error) {
                    if (i === 2) throw error;
                    await new Promise(res => setTimeout(res, 1000 * Math.pow(2, i)));
                }
            }
        }
        
        async function enhancePromptWithGemini() {
            const basePrompt = elements.outputPromptEl.value;
            if (!basePrompt || (basePrompt.includes("[") && !basePrompt.startsWith("["))) {
                alert("Harap lengkapi detail pada form terlebih dahulu.");
                return;
            }
            elements.enhanceButton.disabled = true;
            elements.enhanceButton.innerHTML = `<span class="loader"></span> MENINGKATKAN...`;
            
            const isVideo = elements.designerTabVideo.classList.contains('active');
            const tujuan = elements.tujuanGambarEl.value;
            
            let systemPrompt = "";
             if (isVideo) {
                systemPrompt = "PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang sutradara film dan ahli rekayasa prompt video. Ambil prompt dasar berikut dan buatlah menjadi jauh lebih deskriptif, sinematik, dan profesional. Tambahkan detail spesifik tentang gerakan kamera, sinematografi, pencahayaan, tempo, dan desain suara. Pertahankan subjek inti dan rasio aspek. Balas HANYA dengan teks prompt yang disempurnakan tanpa tambahan atau awalan apapun.";
            } else if (tujuan === 'gabungkan') {
                systemPrompt = "PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah ahli rekayasa prompt untuk image composition. Ubah instruksi dasar pengguna menjadi prompt yang detail dan profesional. Fokus pada cara mengintegrasikan elemen dari foto 1 ke foto 2 secara mulus (pencahayaan, bayangan, skala). Balas HANYA dengan teks prompt yang disempurnakan tanpa tambahan atau awalan apapun.";
            } else if (tujuan === 'karakter') {
                systemPrompt = "PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah ahli penulis karakter dan rekayasa prompt. Ambil 'character sheet' dan skenario dasar pengguna, lalu kembangkan menjadi prompt yang sangat deskriptif dan kaya detail untuk menghasilkan gambar yang konsisten dan sinematik. Fokus pada pengayaan detail karakter di dalam sheet. Balas HANYA dengan teks prompt yang disempurnakan tanpa tambahan atau awalan apapun.";
            } else {
                systemPrompt = "PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang direktur kreatif dan ahli rekayasa prompt. Ambil prompt dasar berikut untuk model pembuatan gambar dan buatlah menjadi jauh lebih deskriptif, menggugah, dan profesional. Tambahkan detail spesifik tentang pencahayaan, komposisi, tekstur, dan suasana hati. Pertahankan subjek inti dan rasio aspek yang sama. Balas HANYA dengan teks prompt yang disempurnakan tanpa tambahan atau awalan apapun.";
            }

            const userQuery = `Berikut adalah prompt dasarnya: "${basePrompt}"`;
            try {
                const enhancedPrompt = await makeApiCallWithRetry(systemPrompt, userQuery);
                if(enhancedPrompt) {
                    let cleanedPrompt = enhancedPrompt.trim().replace(/^"|"$/g, '').replace(/\[Gambar Input\]\s*/i, '');
                    elements.outputPromptEl.value = cleanedPrompt;
                    if (tujuan === 'karakter') {
                         const match = cleanedPrompt.match(/\(character sheet:.*?\)/);
                         if (match) elements.characterSheetOutputEl.value = match[0];
                    }
                }
            } catch (error) {
                elements.outputPromptEl.value = "Maaf, terjadi kesalahan saat menyempurnakan prompt: " + error.message;
            } finally {
                elements.enhanceButton.disabled = false;
                elements.enhanceButton.innerHTML = '<span id="enhance-prompt-text">SEMPURNAKAN PROMPT</span>';
            }
        }
        
        function handleFileSelect(file, type) {
            if (!file || !file.type.startsWith('image/')) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result.split(',')[1];
                const src = e.target.result;

                if (type === 'single') {
                    uploadedImageBase64 = base64;
                    elements.uploadedImagePreview.src = src;
                    if(elements.tujuanGambarEl.value !== 'edit') {
                        elements.tujuanGambarEl.value = 'edit';
                    }
                    handleTujuanGambarChange();
                } else if (type === 'compose1') {
                    composeImage1Base64 = base64;
                    elements.uploadedComposePreview1.src = src;
                    elements.uploadedComposePreview1.parentElement.classList.remove('hidden');
                } else if (type === 'compose2') {
                    composeImage2Base64 = base64;
                    elements.uploadedComposePreview2.src = src;
                    elements.uploadedComposePreview2.parentElement.classList.remove('hidden');
                } else if (type === 'character') {
                    characterRefImageBase64 = base64;
                    elements.uploadedCharPreview.src = src;
                    elements.characterPreviewContainer.classList.remove('hidden');
                }
                updateGeneratedPrompt();
            };
            reader.readAsDataURL(file);
        }
        
        async function analyzeImageWithGemini() {
            if (!uploadedImageBase64) {
                alert("Mohon upload gambar terlebih dahulu.");
                return;
            }
            elements.analyzeImageButton.disabled = true;
            elements.analyzeImageText.textContent = 'MENGANALISA...';
            elements.analyzeImageIcon.innerHTML = `<span class="loader"></span>`;
            elements.imageAnalysisResult.value = "AI sedang menganalisa gambar Anda, mohon tunggu...";
            const systemPrompt = "PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang ahli art director. Analisa gambar yang diberikan. Balas HANYA dengan format ini: '### Analisis Gambar\\n**Subjek Utama:** [Sebutkan subjek utama secara singkat]\\n**Deskripsi:** [Jelaskan gambar secara detail dalam satu paragraf]'. Jangan tambahkan apapun di luar format ini.";
            const userPrompt = "Analisa gambar ini sesuai format yang diperintahkan.";
            const apiKey = apiMode === 'user' ? userApiKey : ""; 
            if (apiMode === 'user' && !apiKey) {
                 elements.imageAnalysisResult.value = "Error: API Key pengguna tidak valid...";
                 return;
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [ { text: userPrompt }, { inlineData: { mimeType: "image/jpeg", data: uploadedImageBase64 } } ] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    elements.imageAnalysisResult.value = analysisText;
                    const subjectMatch = analysisText.match(/\*\*Subjek Utama:\*\*\s*([^\n]+)/i);
                    if (subjectMatch && subjectMatch[1]) {
                        elements.produkGambarEl.value = subjectMatch[1].trim();
                        elements.detailGambarEl.value = `Sempurnakan foto dari "${subjectMatch[1].trim()}" ini...`;
                    } else {
                        elements.detailGambarEl.value = "Sempurnakan gambar ini berdasarkan hasil analisa.";
                    }
                    updateGeneratedPrompt();
                } else { throw new Error("Struktur respons API tidak valid."); }
            } catch (error) {
                elements.imageAnalysisResult.value = "Maaf, terjadi kesalahan saat menganalisa gambar. " + error.message;
            } finally {
                elements.analyzeImageButton.disabled = false;
                elements.analyzeImageText.textContent = 'ANALISA GAMBAR';
                elements.analyzeImageIcon.innerHTML = `üîç`;
            }
        }
       
       async function analyzeCharacterWithGemini() {
            if (!characterRefImageBase64) {
                alert("Mohon upload gambar referensi karakter terlebih dahulu.");
                return;
            }

            elements.analyzeCharButton.disabled = true;
            elements.analyzeCharText.textContent = 'MENGANALISA...';
            elements.analyzeCharIcon.innerHTML = `<span class="loader"></span>`;

            const systemPrompt = `PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang analis karakter dan art director yang sangat detail. Diberikan sebuah gambar, tugas Anda adalah menganalisanya dan mengembalikan deskripsi karakter dalam format JSON yang ketat. Jangan menambahkan teks atau penjelasan lain di luar JSON. JSON harus memiliki properti berikut: "name" (saran nama atau deskripsi singkat, misal: "prajurit wanita futuristik"), "physic" (deskripsi detail tentang wajah, rambut, mata, dan postur tubuh), "attire" (deskripsi detail tentang pakaian dan aksesoris yang dikenakan), dan "style" (deskripsi gaya artistik gambar, misal: "fotorealistis, pencahayaan dramatis" atau "ilustrasi anime 2D").`;
            const userPrompt = "Analisa karakter dalam gambar ini dan berikan hasilnya dalam format JSON sesuai instruksi.";
            
            const apiKey = apiMode === 'user' ? userApiKey : "";
            if (apiMode === 'user' && !apiKey) {
                alert("API Key tidak valid.");
                 elements.analyzeCharButton.disabled = false;
                elements.analyzeCharText.textContent = 'ANALISA KARAKTER & ISI FORM';
                elements.analyzeCharIcon.innerHTML = `ü§ñ`;
                return;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    parts: [
                        { text: userPrompt },
                        { inlineData: { mimeType: "image/jpeg", data: characterRefImageBase64 } }
                    ]
                }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "name": { "type": "STRING" },
                            "physic": { "type": "STRING" },
                            "attire": { "type": "STRING" },
                            "style": { "type": "STRING" }
                        },
                        required: ["name", "physic", "attire", "style"]
                    }
                },
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);

                if (parsedJson) {
                    elements.charNameEl.value = parsedJson.name || '';
                    elements.charPhysicEl.value = parsedJson.physic || '';
                    elements.charAttireEl.value = parsedJson.attire || '';
                    elements.charStyleEl.value = parsedJson.style || '';
                    updateGeneratedPrompt(); 
                } else {
                    throw new Error("Respons JSON tidak valid.");
                }

            } catch (error) {
                console.error("Error calling Gemini Vision API for character analysis:", error);
                alert("Maaf, terjadi kesalahan saat menganalisa karakter: " + error.message);
            } finally {
                elements.analyzeCharButton.disabled = false;
                elements.analyzeCharText.textContent = 'ANALISA KARAKTER & ISI FORM';
                elements.analyzeCharIcon.innerHTML = `ü§ñ`;
            }
        }
        
        async function analyzeVideoImageWithGemini() {
            if (!videoRefImageBase64) {
                alert("Mohon upload gambar referensi untuk video terlebih dahulu.");
                return;
            }

            elements.analyzeVideoImageButton.disabled = true;
            elements.analyzeVideoImageText.textContent = 'MENGANALISA...';
            elements.analyzeVideoImageIcon.innerHTML = `<span class="loader"></span>`;
            elements.videoImageAnalysisResult.classList.remove('hidden');
            elements.videoImageAnalysisResult.value = "AI sedang menganalisa gambar Anda untuk diubah menjadi ide prompt video...";
            
            const systemPrompt = `PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang sutradara film dan analis visual. Diberikan sebuah gambar, tugas Anda adalah mengekstrak esensinya untuk diubah menjadi prompt video. Balas HANYA dengan format JSON yang ketat. JSON harus memiliki properti: "subject" (deskripsi subjek utama dalam 2-5 kata), "action" (deskripsi aksi atau suasana yang tersirat dalam gambar), "background" (deskripsi singkat dan jelas tentang latar belakang), dan "style" (deskripsi gaya visual, potensi gerakan kamera, sinematografi, dan pencahayaan).`;
            const userPrompt = "Analisa gambar ini dan berikan hasilnya dalam format JSON sesuai instruksi sistem.";
            
            const apiKey = apiMode === 'user' ? userApiKey : "";
            if (apiMode === 'user' && !apiKey) {
                alert("API Key tidak valid.");
                elements.analyzeVideoImageButton.disabled = false;
                elements.analyzeVideoImageText.textContent = 'ANALISA GAMBAR & ISI FORM';
                elements.analyzeVideoImageIcon.innerHTML = `ü§ñ`;
                return;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    parts: [
                        { text: userPrompt },
                        { inlineData: { mimeType: "image/jpeg", data: videoRefImageBase64 } }
                    ]
                }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "subject": { "type": "STRING" },
                            "action": { "type": "STRING" },
                            "background": { "type": "STRING" },
                            "style": { "type": "STRING" }
                        },
                        required: ["subject", "action", "background", "style"]
                    }
                },
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);

                if (parsedJson) {
                    elements.subjekVideoSubjectEl.value = parsedJson.subject || '';
                    elements.subjekVideoActionEl.value = parsedJson.action || '';
                    elements.latarBelakangVideoEl.value = parsedJson.background || '';
                    elements.gayaVideoEl.value = parsedJson.style || '';
                    elements.videoImageAnalysisResult.value = `Analisa Selesai:\nSubjek: ${parsedJson.subject}\nAksi: ${parsedJson.action}\nLatar: ${parsedJson.background}\nGaya: ${parsedJson.style}`;
                    updateGeneratedPrompt(); 
                } else {
                    throw new Error("Respons JSON tidak valid.");
                }

            } catch (error) {
                console.error("Error calling Gemini Vision API for video analysis:", error);
                elements.videoImageAnalysisResult.value = "Maaf, terjadi kesalahan saat menganalisa gambar: " + error.message;
            } finally {
                elements.analyzeVideoImageButton.disabled = false;
                elements.analyzeVideoImageText.textContent = 'ANALISA GAMBAR & ISI FORM';
                elements.analyzeVideoImageIcon.innerHTML = `ü§ñ`;
            }
        }


       function handleVideoFileSelect(file) {
           if (file && file.type.startsWith('image/')) {
               videoRefImageFile = file;
               const reader = new FileReader();
               reader.onload = (e) => {
                   videoRefImageBase64 = e.target.result.split(',')[1];
                   elements.uploadedVideoPreview.src = e.target.result;
                   elements.videoPreviewContainer.classList.remove('hidden');
                   updateGeneratedPrompt();
               };
               reader.readAsDataURL(file);
           }
       }
       
       function toggleAssistant() {
            const isHidden = elements.assistantModal.classList.contains('hidden');
            if (isHidden) {
                elements.assistantModal.classList.remove('hidden');
                setTimeout(() => { elements.assistantModal.classList.remove('opacity-0', 'translate-y-4'); }, 10);
            } else {
                elements.assistantModal.classList.add('opacity-0', 'translate-y-4');
                setTimeout(() => { elements.assistantModal.classList.add('hidden'); }, 300);
            }
        }
        
        function parseSimpleMarkdown(text) {
            let safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            return safeText.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
        }

        function addMessageToChat(message, sender, isTyping = false) {
            const messageWrapper = document.createElement('div');
            const messageBubble = document.createElement('div');
            messageWrapper.classList.add('flex', 'w-full', 'min-w-0');
            messageBubble.classList.add('p-3', 'rounded-lg', 'max-w-[85%]', 'chat-bubble');
            if (sender === 'user') {
                messageWrapper.classList.add('justify-end');
                messageBubble.classList.add('bg-accent-color', 'text-accent-text');
            } else {
                messageWrapper.classList.add('justify-start');
                messageBubble.classList.add('bg-tertiary', 'text-primary');
            }
            if (isTyping) {
                messageBubble.innerHTML = '<div class="typing-indicator"><span>.</span><span>.</span><span>.</span></div>';
                messageBubble.id = 'typing-bubble';
            } else {
                 messageBubble.innerHTML = parseSimpleMarkdown(message);
            }
            messageWrapper.appendChild(messageBubble);
            elements.assistantChatBody.appendChild(messageWrapper);
            elements.assistantChatBody.scrollTop = elements.assistantChatBody.scrollHeight;
        }

        function updateLastAssistantMessage(newMessage) {
            const typingBubble = document.getElementById('typing-bubble');
            if (typingBubble) {
                typingBubble.innerHTML = parseSimpleMarkdown(newMessage);
                typingBubble.removeAttribute('id');
            }
             elements.assistantChatBody.scrollTop = elements.assistantChatBody.scrollHeight;
        }

        async function handleSendMessage() {
            const message = elements.assistantInput.value.trim();
            if (!message) return;
            addMessageToChat(message, 'user');
            elements.assistantInput.value = '';
            elements.assistantInput.disabled = true;
            elements.sendAssistantMessage.disabled = true;
            addMessageToChat('', 'assistant', true);
            const systemPrompt = `PENTING: Jawaban Anda HARUS dalam Bahasa Indonesia. Anda adalah seorang ahli rekayasa prompt (prompt engineering) dengan pengalaman puluhan tahun. Pengetahuan Anda telah diperbarui dengan dokumentasi resmi terbaru. Spesialisasi Anda adalah pada model-model Google berikut:

1.  **Model Gambar (dikenal sebagai Nano Banana atau gemini-2.5-flash-image-preview):** Anda tahu bahwa model ini sangat kuat dalam pemahaman bahasa alami dan bekerja paling baik dengan deskripsi naratif, bukan hanya kata kunci. Anda paham kemampuannya meliputi: Text-to-Image, Image+Text-to-Image (editing seperti menambah/menghapus elemen), Multi-Image to Image (komposisi & transfer gaya), dan rendering teks yang akurat untuk logo/poster. Anda juga tahu semua gambar yang dihasilkan memiliki watermark SynthID.

2.  **Model Video (Veo3):** Anda tahu model ini menghasilkan video high-fidelity hingga 1080p dengan durasi 8 detik, lengkap dengan audio yang dihasilkan secara alami (dialog, SFX, ambient). Anda paham cara mem-prompt-nya dengan subjek, aksi, gaya, kontrol kamera, dan juga prompt negatif. Anda tahu Veo3 bisa di-inisiasi dengan sebuah gambar (Image-to-Video).

Ketika menjawab pertanyaan pengguna, berikan jawaban yang praktis, mendalam, dan profesional berdasarkan pengetahuan ini.`;
            try {
                const response = await makeApiCallWithRetry(systemPrompt, message);
                updateLastAssistantMessage(response);
            } catch (error) {
                updateLastAssistantMessage("Maaf, saya sedang mengalami gangguan... " + error.message);
            } finally {
                elements.assistantInput.disabled = false;
                elements.sendAssistantMessage.disabled = false;
                elements.assistantInput.focus();
            }
        }
        
        function updateDropdownButton(selectedOption) {
            if (selectedOption) {
                elements.aspectRatioButton.innerHTML = selectedOption.innerHTML;
            }
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            elements.useSharedEnvBtn.addEventListener('click', () => {
                window.open('https://g.co/gemini/share/ec7fc3fd066b', '_blank');
            });
            elements.useUserApiKeyBtn.addEventListener('click', () => {
                elements.apiKeySection.classList.toggle('active');
            });
            elements.startWithApiKeyBtn.addEventListener('click', () => {
                const key = elements.apiKeyInput.value.trim();
                if (key) {
                    userApiKey = key;
                    apiMode = 'user';
                    elements.welcomeScreen.style.display = 'none';
                    elements.mainApp.classList.add('active');
                    elements.assistantButton.classList.remove('hidden');
                } else {
                    elements.apiKeyInput.focus();
                    elements.apiKeyInput.classList.add('border-red-500', 'animate-pulse');
                    setTimeout(() => elements.apiKeyInput.classList.remove('border-red-500', 'animate-pulse'), 2000);
                }
            });

            elements.themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                const newTheme = isDark ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            elements.mainTabButtons.belajar.addEventListener('click', () => showTab('belajar'));
            elements.mainTabButtons.desainer.addEventListener('click', () => showTab('desainer'));
            
            elements.designerTabImage.addEventListener('click', () => switchDesignerTab('image'));
            elements.designerTabVideo.addEventListener('click', () => switchDesignerTab('video'));
            
            elements.allFormInputs.forEach(el => el.addEventListener('input', updateGeneratedPrompt));
            elements.tujuanGambarEl.addEventListener('change', handleTujuanGambarChange);
            
            const backToDefault = () => {
                elements.tujuanGambarEl.value = 'produk'; // Default value
                handleTujuanGambarChange();
            };

            elements.backToTujuanButton.addEventListener('click', backToDefault);
            elements.backToTujuanButtonChar.addEventListener('click', backToDefault);


            elements.copyButton.addEventListener('click', () => {
                elements.outputPromptEl.select();
                try {
                    document.execCommand('copy');
                    elements.copyButton.textContent = 'DISALIN!';
                    setTimeout(() => { elements.copyButton.textContent = 'SALIN'; }, 2000);
                } catch (err) {
                    elements.copyButton.textContent = 'GAGAL';
                }
            });

            elements.enhanceButton.addEventListener('click', enhancePromptWithGemini);

            // File Upload Listeners
            elements.imageUploadEl.addEventListener('change', (event) => handleFileSelect(event.target.files[0], 'single'));
            elements.dropZone.addEventListener('drop', (e) => { e.preventDefault(); handleFileSelect(e.dataTransfer.files[0], 'single'); });
            
            elements.imageUploadCompose1.addEventListener('change', (event) => handleFileSelect(event.target.files[0], 'compose1'));
            elements.dropZoneCompose1.addEventListener('drop', (e) => { e.preventDefault(); handleFileSelect(e.dataTransfer.files[0], 'compose1'); });
            
            elements.imageUploadCompose2.addEventListener('change', (event) => handleFileSelect(event.target.files[0], 'compose2'));
            elements.dropZoneCompose2.addEventListener('drop', (e) => { e.preventDefault(); handleFileSelect(e.dataTransfer.files[0], 'compose2'); });
            
            elements.imageUploadChar.addEventListener('change', (event) => handleFileSelect(event.target.files[0], 'character'));
            elements.dropZoneChar.addEventListener('drop', (e) => { e.preventDefault(); handleFileSelect(e.dataTransfer.files[0], 'character'); });

            ['dragover', 'dragleave'].forEach(eventName => {
                [elements.dropZone, elements.dropZoneCompose1, elements.dropZoneCompose2, elements.dropZoneVideo, elements.dropZoneChar].forEach(zone => {
                    zone.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        if (eventName === 'dragover') zone.classList.add('border-accent-color', 'bg-tertiary');
                        else zone.classList.remove('border-accent-color', 'bg-tertiary');
                    });
                });
            });

            elements.removeImageButton.addEventListener('click', () => {
                uploadedImageBase64 = null;
                elements.imageUploadEl.value = '';
                elements.imagePreviewContainer.classList.add('hidden');
                elements.produkGambarEl.value = '';
                elements.gayaGambarEl.value = '';
                elements.detailGambarEl.value = '';
                handleTujuanGambarChange();
            });
            elements.removeCompose1.addEventListener('click', () => {
                composeImage1Base64 = null;
                elements.imageUploadCompose1.value = '';
                elements.uploadedComposePreview1.src = '';
                elements.uploadedComposePreview1.parentElement.classList.add('hidden');
                updateGeneratedPrompt();
            });
            elements.removeCompose2.addEventListener('click', () => {
                composeImage2Base64 = null;
                elements.imageUploadCompose2.value = '';
                elements.uploadedComposePreview2.src = '';
                elements.uploadedComposePreview2.parentElement.classList.add('hidden');
                updateGeneratedPrompt();
            });
            elements.removeCharImageButton.addEventListener('click', () => {
                characterRefImageBase64 = null;
                elements.imageUploadChar.value = '';
                elements.characterPreviewContainer.classList.add('hidden');
                elements.uploadedCharPreview.src = '';
            });

            elements.analyzeImageButton.addEventListener('click', analyzeImageWithGemini);
            elements.analyzeCharButton.addEventListener('click', analyzeCharacterWithGemini);
            elements.analyzeVideoImageButton.addEventListener('click', analyzeVideoImageWithGemini);


            elements.imageUploadVideoEl.addEventListener('change', (event) => { handleVideoFileSelect(event.target.files[0]); });
            elements.dropZoneVideo.addEventListener('drop', (e) => { e.preventDefault(); handleVideoFileSelect(e.dataTransfer.files[0]); });
            elements.removeVideoButton.addEventListener('click', () => {
                videoRefImageFile = null;
                videoRefImageBase64 = null;
                elements.imageUploadVideoEl.value = '';
                elements.videoPreviewContainer.classList.add('hidden');
                elements.videoImageAnalysisResult.classList.add('hidden');
                elements.videoImageAnalysisResult.value = '';
                updateGeneratedPrompt();
            });
            
            elements.assistantButton.addEventListener('click', toggleAssistant);
            elements.closeAssistantModal.addEventListener('click', toggleAssistant);
            elements.sendAssistantMessage.addEventListener('click', handleSendMessage);
            elements.assistantInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendMessage(); });

            elements.aspectRatioButton.addEventListener('click', () => elements.aspectRatioMenu.classList.toggle('hidden'));
            elements.aspectRatioOptions.forEach(option => {
                option.addEventListener('click', () => {
                    selectedAspectRatio = option.dataset.ratio;
                    updateDropdownButton(option);
                    elements.aspectRatioMenu.classList.add('hidden');
                    updateGeneratedPrompt();
                });
            });
            document.addEventListener('click', (e) => {
                if (!elements.aspectRatioDropdown.contains(e.target)) {
                    elements.aspectRatioMenu.classList.add('hidden');
                }
            });
        }
       
       // --- Initial Setup ---
       function init() {
           const savedTheme = localStorage.getItem('theme') || 'dark';
           applyTheme(savedTheme);
           
           const initialOption = elements.aspectRatioMenu.querySelector('.aspect-ratio-option');
           updateDropdownButton(initialOption);
           
           handleTujuanGambarChange();
           switchDesignerTab('image');
           showTab('belajar');
           
           addMessageToChat("Halo! Saya Asisten Ahli Prompt. Apa yang bisa saya bantu hari ini?", "assistant");
           
           elements.uploadedComposePreview1.parentElement.classList.add('hidden');
           elements.uploadedComposePreview2.parentElement.classList.add('hidden');
           
           setupEventListeners();
       }
       
       init();
    });
    </script>
</body>
</html>
